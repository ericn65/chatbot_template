name: Test Suite

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  test-suite:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›ï¸ Checkout Repository
        uses: actions/checkout@v4

      - name: âš¡ Install Dependencies and Setup Environment
        run: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "$HOME/.local/bin:$HOME/.cargo/bin" >> $GITHUB_PATH
          uv sync

      - name: ğŸ› ï¸ Configure Git for Test Repo
        run: |
          git config --global init.defaultBranch main
          git config --global user.name "GitHubActions"
          git config --global user.email "github-actions@users.noreply.github.com"

      - name: ğŸ” Ensure Pre-Commit, Pytest and Mypy are Installed
        run: |
          uv run pre-commit --version
          uv run pytest --version
          uv run mypy --version

      - name: ğŸª Run Pre-Commit Hooks
        run: |
          uv run pre-commit run --all-files || { echo "âŒ Pre-commit hooks failed"; exit 1; }

      - name: ğŸ‘®â€â™‚ï¸ Run Mypy Checks
        run: |
          uv run mypy || { echo "âŒ Mypy checks failed"; exit 1; }

      - name: âœ… Run Pytests
        run: |
          if [ -n "$(find tests -name '*.py' -type f)" ]; then
            uv run pytest || { echo "âŒ Pytests failed"; exit 1; }
          else
            echo "âš ï¸ No test files found";
          fi
